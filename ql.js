// Generated by CoffeeScript 1.9.1
var ops, ql;

ops = require('./ops');

ql = function(query, def) {
  var _, fn1, fn2, fn3, fn4, i, len, name, ref, ref1, ref2, ref3, res, source;
  res = {
    query: function() {
      return query;
    },
    fresh: function() {
      query.__fresh = true;
      return res;
    },
    clone: function() {
      return ql(query, def);
    }
  };
  for (i = 0, len = def.length; i < len; i++) {
    source = def[i];
    ref = source.params;
    fn1 = function(name) {
      return res[name] = function(params) {
        query = ql.params(name, params, query);
        return res;
      };
    };
    for (name in ref) {
      _ = ref[name];
      fn1(name);
    }
    ref1 = source.unary;
    fn2 = function(name) {
      return res[name] = function() {
        query = ql.unary(name, query);
        return res;
      };
    };
    for (name in ref1) {
      _ = ref1[name];
      fn2(name);
    }
    ref2 = source.binary;
    fn3 = function(name) {
      return res[name] = function(right) {
        query = ql.binary(name, query, right);
        return res;
      };
    };
    for (name in ref2) {
      _ = ref2[name];
      fn3(name);
    }
    ref3 = source.trinary;
    fn4 = function(name) {
      return res[name] = function(left, right) {
        query = ql.trinary(name, query, left, right);
        return res;
      };
    };
    for (name in ref3) {
      _ = ref3[name];
      fn4(name);
    }
  }
  return res;
};

ql.use = function(def) {
  var _, fn, fn1, fn2, fn3, fn4, i, len, name, ref, ref1, ref2, ref3, res, source;
  res = function(query) {
    return ql(query, res.providers);
  };
  for (name in ql) {
    fn = ql[name];
    res[name] = fn;
  }
  res.providers = [];
  res.use = function(def) {
    res.providers.push(def);
    return res;
  };
  ref = def.params;
  fn1 = function(name) {
    return res[name] = function(params, source) {
      return res.params(name, params, source);
    };
  };
  for (name in ref) {
    _ = ref[name];
    fn1(name);
  }
  ref1 = def.unary;
  fn2 = function(name) {
    return res[name] = function(source) {
      return res.unary(name, source);
    };
  };
  for (name in ref1) {
    _ = ref1[name];
    fn2(name);
  }
  ref2 = def.binary;
  fn3 = function(name) {
    return res[name] = function(left, right) {
      return res.binary(name, left, right);
    };
  };
  for (name in ref2) {
    _ = ref2[name];
    fn3(name);
  }
  ref3 = def.trinary;
  fn4 = function(name) {
    return res[name] = function(params, left, right) {
      return res.trinary(name, params, left, right);
    };
  };
  for (name in ref3) {
    _ = ref3[name];
    fn4(name);
  }
  res;
  for (i = 0, len = ops.length; i < len; i++) {
    source = ops[i];
    res.use(source);
  }
  return res.use(def);
};

ql.params = function(name, params, source) {
  return {
    __query: name,
    __params: params,
    __source: source
  };
};

ql.unary = function(name, source) {
  return {
    __query: name,
    __source: source
  };
};

ql.binary = function(name, left, right) {
  return {
    __query: name,
    __left: left,
    __right: right
  };
};

ql.trinary = function(name, params, left, right) {
  return {
    __query: name,
    __params: params,
    __left: left,
    __right: right
  };
};

ql.desc = require('./ql/desc');

ql.merge = require('./ql/merge');

ql.split = require('./ql/split');

ql.diff = require('./ql/diff');

ql.build = require('./ql/build');

ql.exec = require('./ql/exec');

module.exports = ql;
